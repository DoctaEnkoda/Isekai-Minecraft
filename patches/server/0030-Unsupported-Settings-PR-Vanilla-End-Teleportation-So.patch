From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Bierque Jason <bierquejason@gmail.com>
Date: Thu, 3 Aug 2023 09:27:26 +0200
Subject: [PATCH] Unsupported Settings : [PR] Vanilla End Teleportation Source
 : https://github.com/PaperMC/Folia/pull/110


diff --git a/src/main/java/fr/euphilia/tenseimc/TenseiConfig.java b/src/main/java/fr/euphilia/tenseimc/TenseiConfig.java
index 7922ba7c4175572bd378b50c03725a5b02d2df3f..dbb685483d810b9f130306ed7369907ac00a2147 100644
--- a/src/main/java/fr/euphilia/tenseimc/TenseiConfig.java
+++ b/src/main/java/fr/euphilia/tenseimc/TenseiConfig.java
@@ -161,4 +161,9 @@ public class TenseiConfig {
             set("settings.blocks.beehive.max-bees-inside", null);
         }
     }
+
+    public static boolean useVanillaEndTeleportation = false;
+    private static void settingsUnsupported() {
+        useVanillaEndTeleportation = getBoolean("settings.unsupported.pr-folia.vanilla-end-teleportation", useVanillaEndTeleportation);
+    }
 }
diff --git a/src/main/java/net/minecraft/world/entity/Entity.java b/src/main/java/net/minecraft/world/entity/Entity.java
index e1b6673729e71bdc929bc7b76983108a59e55891..c10a8c7b04b8303ad215b68efe59fed3eca61f8b 100644
--- a/src/main/java/net/minecraft/world/entity/Entity.java
+++ b/src/main/java/net/minecraft/world/entity/Entity.java
@@ -4099,9 +4099,17 @@ public abstract class Entity implements Nameable, EntityAccess, CommandSource {
 
                             // the portal obsidian is placed at targetPos.y - 2, so if we want to place the entity
                             // on the obsidian, we need to spawn at targetPos.y - 1
-                            portalInfoCompletable.complete(
-                                new PortalInfo(Vec3.atBottomCenterOf(targetPos.below()), Vec3.ZERO, 90.0f, 0.0f, destination, null)
-                            );
+                            // TenseiMC start
+                            if (fr.euphilia.tenseimc.TenseiConfig.useVanillaEndTeleportation) {
+                                Vec3 finalPos = this instanceof Player ? Vec3.atBottomCenterOf(targetPos.below()) : Vec3.atBottomCenterOf(targetPos);
+                                portalInfoCompletable.complete(
+                                        new PortalInfo(finalPos, this.getDeltaMovement(), 90.0f, 0.0f, destination, null)
+                                );
+                            } else {
+                                portalInfoCompletable.complete(
+                                        new PortalInfo(Vec3.atBottomCenterOf(targetPos.below()), Vec3.ZERO, 90.0f, 0.0f, destination, null)
+                                );
+                            } // TenseiMC end
                         }
                     );
                 } else {
