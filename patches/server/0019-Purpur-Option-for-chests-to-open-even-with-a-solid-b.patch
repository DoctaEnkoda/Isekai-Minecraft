From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jason Penilla <11360596+jpenilla@users.noreply.github.com>
Date: Wed, 14 Jun 2023 18:29:00 +0200
Subject: [PATCH] Purpur - Option for chests to open even with a solid block on
 top


diff --git a/src/main/java/fr/euphilia/tenseimc/TenseiWorldConfig.java b/src/main/java/fr/euphilia/tenseimc/TenseiWorldConfig.java
index 1e923c02560a52c00d3800f02224f201f39d67cb..efd8bb64030dbdb4655cd01d11cfb41d4de615d4 100644
--- a/src/main/java/fr/euphilia/tenseimc/TenseiWorldConfig.java
+++ b/src/main/java/fr/euphilia/tenseimc/TenseiWorldConfig.java
@@ -78,8 +78,12 @@ public class TenseiWorldConfig {
     }
 
     public boolean buddingAmethystBreakWithSilkTouch = false;
+    public boolean chestOpenWithBlockOnTop = false;
     private void blockSettings() {
         buddingAmethystBreakWithSilkTouch = getBoolean("blocks.budding_amethyst.break.silk_touch", buddingAmethystBreakWithSilkTouch);
+        if (TenseiConfig.version < 2) {
+            chestOpenWithBlockOnTop = getBoolean("blocks.chest.open-with-solid-block-on-top", chestOpenWithBlockOnTop);
+        }
     }
 
     public double playerCriticalDamageMultiplier = 1.5D;
@@ -105,6 +109,7 @@ public class TenseiWorldConfig {
             set("blocks.piston.block-push-limit", null);
             set("blocks.beacon.effect-range", null);
             set("gameplay-mechanics.player.critical-damage-multiplier", null);
+            set("blocks.chest.open-with-solid-block-on-top", null);
         }
     }
 
diff --git a/src/main/java/net/minecraft/world/level/block/ChestBlock.java b/src/main/java/net/minecraft/world/level/block/ChestBlock.java
index 5e22d175b1048a58802cdf64ac70a8b56329e915..b32f5e021e372f2a35e3e67dc9142145d03e3192 100644
--- a/src/main/java/net/minecraft/world/level/block/ChestBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/ChestBlock.java
@@ -355,6 +355,7 @@ public class ChestBlock extends AbstractChestBlock<ChestBlockEntity> implements
     }
 
     private static boolean isBlockedChestByBlock(BlockGetter world, BlockPos pos) {
+        if (world instanceof Level level && level.purpurConfig.chestOpenWithBlockOnTop) return false; // TenseiMC
         BlockPos blockposition1 = pos.above();
 
         return world.getBlockState(blockposition1).isRedstoneConductor(world, blockposition1);
diff --git a/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java b/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
index eb35e0be366b416618fd89a532b08619ef617fe9..0d1b9d43ce81e4931c8e5beea2b29adfd3a56a35 100644
--- a/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
+++ b/src/main/java/org/purpurmc/purpur/PurpurWorldConfig.java
@@ -133,6 +133,15 @@ public class PurpurWorldConfig {
         beaconLevelFour = getInt("blocks.beacon.effect-range.level-4", beaconLevelFour);
     }
 
+    public boolean chestOpenWithBlockOnTop = false;
+    private void chestSettings() {
+        if (TenseiConfig.version < 2) {
+            chestOpenWithBlockOnTop = this.tenseiWorldConfig.chestOpenWithBlockOnTop;
+            set("blocks.chest.open-with-solid-block-on-top", chestOpenWithBlockOnTop);
+        }
+        chestOpenWithBlockOnTop = getBoolean("blocks.chest.open-with-solid-block-on-top", chestOpenWithBlockOnTop);
+    }
+
     public double playerCriticalDamageMultiplier = 1.5D;
     private void playerSettings() {
         if (TenseiConfig.version < 2) {
